(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{256:function(v,_,t){"use strict";t.r(_);var d=t(28),e=Object(d.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"bcsv"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bcsv"}},[v._v("#")]),v._v(" BCSV")]),v._v(" "),t("p",[v._v("BCSV 是一种二进制压缩的 CSV 文件，共有 167 个。BCSV 中存储了大量游戏内的数据和参数，可以认为是其核心数据库。")]),v._v(" "),t("h2",{attrs:{id:"二进制格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二进制格式"}},[v._v("#")]),v._v(" 二进制格式")]),v._v(" "),t("p",[v._v("BCSV 由三部分组成：")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("名称")]),v._v(" "),t("th",[v._v("长度")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("头部")]),v._v(" "),t("td",[v._v("28 [1Ch]")])]),v._v(" "),t("tr",[t("td",[v._v("字段定义")]),v._v(" "),t("td",[v._v("8 * 字段个数")])]),v._v(" "),t("tr",[t("td",[v._v("数据条目")]),v._v(" "),t("td",[v._v("每条数据长度 * 总条数")])])])]),v._v(" "),t("h3",{attrs:{id:"头部"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#头部"}},[v._v("#")]),v._v(" 头部")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("偏移量")]),v._v(" "),t("th",[v._v("格式")]),v._v(" "),t("th",[v._v("说明")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("0x00")]),v._v(" "),t("td",[v._v("uint32")]),v._v(" "),t("td",[v._v("数据条目个数")])]),v._v(" "),t("tr",[t("td",[v._v("0x04")]),v._v(" "),t("td",[v._v("uint32")]),v._v(" "),t("td",[v._v("每条数据长度")])]),v._v(" "),t("tr",[t("td",[v._v("0x08")]),v._v(" "),t("td",[v._v("uint16")]),v._v(" "),t("td",[v._v("字段个数")])]),v._v(" "),t("tr",[t("td",[v._v("0x0a")]),v._v(" "),t("td",[v._v("byte")]),v._v(" "),t("td",[v._v("未知")])]),v._v(" "),t("tr",[t("td",[v._v("0x0b")]),v._v(" "),t("td",[v._v("byte")]),v._v(" "),t("td",[v._v("未知")])]),v._v(" "),t("tr",[t("td",[v._v("0x0c")]),v._v(" "),t("td",[v._v("[4]byte")]),v._v(" "),t("td",[v._v('Magic 固定值 "VSCB"')])]),v._v(" "),t("tr",[t("td",[v._v("0x10")]),v._v(" "),t("td",[v._v("[2]byte")]),v._v(" "),t("td",[v._v("未知")])]),v._v(" "),t("tr",[t("td",[v._v("0x12")]),v._v(" "),t("td",[v._v("[10]byte")]),v._v(" "),t("td",[v._v("0 Padding")])])])]),v._v(" "),t("h3",{attrs:{id:"字段定义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字段定义"}},[v._v("#")]),v._v(" 字段定义")]),v._v(" "),t("p",[v._v("每个字段定义均为 8 个字节，按顺序给出。每个字段定义由两部分组成。")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("相对偏移量")]),v._v(" "),t("th",[v._v("格式")]),v._v(" "),t("th",[v._v("说明")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("0x00")]),v._v(" "),t("td",[v._v("[4]byte")]),v._v(" "),t("td",[v._v("字段 ID")])]),v._v(" "),t("tr",[t("td",[v._v("0x04")]),v._v(" "),t("td",[v._v("uint32")]),v._v(" "),t("td",[v._v("字段开始位置基于条目数据的相对偏移量")])])])]),v._v(" "),t("p",[v._v("字段 ID 是原始字段名称的 CRC32 hash，因此占 4 字节。原始的字段名称格式为 "),t("code",[v._v("fidleName type")]),v._v("，"),t("code",[v._v("fieldName")]),v._v(" 是一般字符串名称，"),t("code",[v._v("type")]),v._v(" 表示字段数据类型，例如 "),t("code",[v._v("ItemID u16")]),v._v("。目前已知的有以下几种：")]),v._v(" "),t("ul",[t("li",[t("code",[v._v("u8")]),v._v(" "),t("code",[v._v("u16")]),v._v(" "),t("code",[v._v("u32")]),v._v("：不同长度的无符号整数")]),v._v(" "),t("li",[t("code",[v._v("s8")]),v._v(" "),t("code",[v._v("s16")]),v._v(" "),t("code",[v._v("s32")]),v._v("：不同长度的符号整数")]),v._v(" "),t("li",[t("code",[v._v("f32")]),v._v("：单精度浮点数")]),v._v(" "),t("li",[t("code",[v._v("stringXX")]),v._v("：长度为 "),t("code",[v._v("XX")]),v._v(" 字节的 UTF-8 字符串")])]),v._v(" "),t("p",[v._v("原始字段名称会在编译阶段被替换成最终的 CRC32 值，因此从 CRC32 值反向推断原始字段名比较困难。然而，游戏二进制中存在一些原始字段名的字符串数据，Github 上 "),t("a",{attrs:{href:"https://github.com/Treeki/CylindricalEarth/issues/4",target:"_blank",rel:"noopener noreferrer"}},[v._v("CylindricalEarth"),t("OutboundLink")],1),v._v(" 对一些原始字段名进行了挖掘。")]),v._v(" "),t("p",[v._v("根据第二项偏移量，结合头部中的每条数据长度，我们可以计算出每个字段的长度。")]),v._v(" "),t("h3",{attrs:{id:"数据条目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据条目"}},[v._v("#")]),v._v(" 数据条目")]),v._v(" "),t("p",[v._v("所有数据条目依次存储于字段定义之后。")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("相对偏移量")]),v._v(" "),t("th",[v._v("格式")]),v._v(" "),t("th",[v._v("说明")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("0x00")]),v._v(" "),t("td",[v._v("uint32")]),v._v(" "),t("td",[v._v("当前位置基于文件整体的偏移量")])]),v._v(" "),t("tr",[t("td",[v._v("0x04")]),v._v(" "),t("td",[v._v("可变")]),v._v(" "),t("td",[v._v("各个字段的具体数据")])])])]),v._v(" "),t("p",[v._v("每个数据条目中均按字段定义中的长度和顺序依次保存。")]),v._v(" "),t("h2",{attrs:{id:"关于枚举类型的字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于枚举类型的字段"}},[v._v("#")]),v._v(" 关于枚举类型的字段")]),v._v(" "),t("p",[v._v("有很多字段的取值是枚举（enum）类，即固定从某几个值中选择。目前尚不明确枚举类型在字段 ID 中使用什么名称表示 "),t("code",[v._v("type")]),v._v("。枚举类的值可以从二进制中提取，它们都是以英文和日文成对出现的。在 BCSV 中，存储的是值的 CRC32 hash（英文或日文的 CRC 均有可能），因此枚举类的字段长度一定是 4 字节。")]),v._v(" "),t("p",[v._v("例如，在 "),t("code",[v._v("AITag.bcsv")]),v._v(" 中，第一个字段就是枚举类型，CRC32 的字段 ID 为 "),t("code",[v._v("70 CF EA A8")]),v._v("，以小端序读取，可以记为 uint32 形式 "),t("code",[v._v("2833960816")]),v._v("。它有四种取值：")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("英文取值")]),v._v(" "),t("th",[v._v("日文取值")]),v._v(" "),t("th",[v._v("英文取值 CRC32")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("Season")]),v._v(" "),t("td",[v._v("季節")]),v._v(" "),t("td",[t("code",[v._v("0xF7485E9F")])])]),v._v(" "),t("tr",[t("td",[v._v("MinorSeries")]),v._v(" "),t("td",[v._v("裏シリーズ")]),v._v(" "),t("td",[t("code",[v._v("0x314A4625")])])]),v._v(" "),t("tr",[t("td",[v._v("Purpose")]),v._v(" "),t("td",[v._v("目的")]),v._v(" "),t("td",[t("code",[v._v("0x773A8A77")])])]),v._v(" "),t("tr",[t("td",[v._v("None")]),v._v(" "),t("td",[v._v("なし")]),v._v(" "),t("td",[t("code",[v._v("0xDFA2AFF1")])])])])]),v._v(" "),t("p",[v._v("该文件的第一条数据的第一个字段的值为 "),t("code",[v._v("9F 5E 48 F7")]),v._v("，即实际对应到「Season | 季節 」值。")]),v._v(" "),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[v._v("#")]),v._v(" 参考资料")]),v._v(" "),t("ul",[t("li",[v._v("https://wiki.oatmealdome.me/BCSV")])])])}),[],!1,null,null,null);_.default=e.exports}}]);