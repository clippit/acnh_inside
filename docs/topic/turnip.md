# 大头菜价格行情解读

目前已知最早公开的大头菜行情分析来自于 Twitter 用户 [@_Ninji](https://twitter.com/_Ninji) 对游戏程序的逆向结果。基于这一成果，我们可以总结出每周大头菜的价格变化趋势。

## 买入价

周日上午可以进行大头菜买入操作。买入价介于 **90 到 110 铃钱**。需要注意的是，后续的行情变化会参考这一「买入价」，但是只有本岛的买入价会和本岛的价格走势相关。也就是说，玩家去别人的岛时，其买入价和后续价格都是按照他人岛上的趋势变化，即使你没有在本岛进行买入操作，本岛依然会存在一个买入价，并且影响到后续的价格变化。

## 价格走势模型

确定买入价时，也会同时确定一周内的价格走势模型。本周的价格走势模型会受到上周模型的影响。一共有四种走势：

* 震荡
* 暴涨
* 阴跌
* 小涨

下表展示了上周走势和下周走势的相关关系：

| 上周走势 | 下周 震荡 概率 | 下周 暴涨 概率 | 下周 阴跌 概率 | 下周 小涨 概率 |
|----------|----------------|----------------|----------------|----------------|
| 震荡     | 20%            | 30%            | 15%            | 35%            |
| 暴涨     | 50%            | 5%             | 20%            | 25%            |
| 阴跌     | 25%            | 45%            | 5%             | 25%            |
| 小涨     | 45%            | 25%            | 15%            | 15%            |

每个价格走势模型在未来一周内都会由数个「阶段」组成，阶段的时长和数量各有不同。价格变化的最小单位是半天，分别在 0 点和 12 点更新，因此一周内会经历 12 次变化。但是由于 Nook 商店的营业时间是早上 8 点到晚上 10 点，因此上午段的卖出窗口只有 4 个小时，而下午段的卖出窗口有 10 个小时。

## 震荡模型

震荡模型由五个阶段依次组成：

1. 📈第一次上涨
2. 📉第一次下跌
3. 📈第二次上涨
4. 📉第二次下跌
5. 📈第三次上涨

下表描述了每个阶段的持续时间。

| 阶段 | 持续时间确定方式 |
|------|------------------|
| 第一次上涨 | 随机确定 **0-6 个半天** |
| 第一次下跌 | 50% 几率为 **2 个半天**<br>50% 几率为 **3 个半天** |
| 第二次上涨 | 三次上涨的时间总和固定为 7 个半天。<br>首先确定 **「第二次上涨」和「第三次上涨」的总持续时间** 为：<br>7 个半天减去「第一次上涨」的持续时间<br><br>然后再确定「第三次上涨」的持续时间，**最终剩下的时间**归于本阶段 |
| 第二次下跌 | 5 个半天减去「第一次下跌」的持续时间，<br>即两次下跌的时间总和是 5 个半天，因此可能是 **2-3 个半天** |
| 第三次上涨 | 随机确定 **0 至「第二次上涨」和「第三次上涨」的总持续时间 - 1**。<br>也就是说，至少会给「第二次上涨」分配 1 个半天的时间。 |

每个阶段内，每个半天的价格都是在「买入价」的基础上乘以一个「比例」得到（如遇小数则向上取整），下表描述了该「比例」的变化方式，比例的区间选择均为随机。

| 阶段 | 比例变化 |
|------|----------|
| 第一次上涨 | 随机为 **90%-140%** |
| 第一次下跌 | 阶段开始时随机为 **60%-80%**，<br>其后每个半天的比例都会在前一个半天的价格比例基础上下调 4-10 个百分点 |
| 第二次上涨 | 和「第一次上涨」相同 |
| 第二次下跌 | 和「第一次下跌」相同 |
| 第三次上涨 | 和「第一次上涨」相同 |

在震荡模型中，你可以获得的最高卖出价是买入价的 140%。

## 暴涨模型

暴涨模型由四个阶段构成：

1. 📉稳定下跌
3. 📈📈暴涨
4. 📉📉暴跌
5. 📉随机下跌

下表描述了每个阶段的持续时间。

| 阶段 | 持续时间确定方式 |
|------|------------------|
| 稳定下跌 | 随机为 1-7 个半天 |
| 暴涨 | 固定为 3 个半天 |
| 暴跌 | 固定为 2 个半天 |
| 随机下跌 | 12 个半天中剩下的时间<br>如果暴涨阶段从第 8 个半天才开始，则不会进入该阶段 |

每个阶段内，每个半天的价格都是在「买入价」的基础上乘以一个「比例」得到（如遇小数则向上取整），下表描述了该「比例」的变化方式，比例的区间选择均为随机。

| 阶段 | 持续时间确定方式 |
|------|------------------|
| 稳定下跌 | 阶段开始时为 **85%-90%**，<br>其后每个半天的比例都会在前一个半天的价格比例基础上下调 3-5 个百分点 |
| 暴涨 | 第 1 个半天： **90%-140%**<br>第 2 个半天：**140%-200%**<br>第 3 个半天：**200-600%** |
| 暴跌 | 第 1 个半天： **140%-200%**<br>第 2 个半天：**90%-140%** |
| 随机下跌 | 随机为 **40%-90%**  |

在暴涨模型中，你最多可以以买入价的 6 倍卖出。如果买入价为 110，则会触发游戏中的最高卖出价 660 铃钱。

## 阴跌模型

阴跌模型只包含一个阶段，即📉稳定下跌阶段，其中每个半天的价格都是在「买入价」的基础上乘以一个「比例」得到（如遇小数则向上取整），在第 1 个半天，比例随机为 **85%-90%**，其后的每个半天，该比例都会在前一个半天的比例基础上下调 3-5 个百分点。

在该模型下的最低卖出价格表现为在 85% 的基础上每个半天都下跌 5 个百分点，到周六下午，比例已降至 30%。

## 小涨模型

小涨模型由四个阶段构成：

1. 📉第一次下跌
3. 📈上涨
4. 📉📉第二次下跌

下表描述了每个阶段的持续时间。

| 阶段 | 持续时间确定方式 |
|------|------------------|
| 第一次下跌 | 随机为 0-7 个半天 |
| 上涨 | 固定为 5 个半天 |
| 第二次下跌 | 12 个半天中剩下的时间<br>如果上涨阶段从第 8 个半天才开始，则不会进入该阶段 |

每个阶段内，每个半天的价格都是在「买入价」的基础上乘以一个「比例」得到（如遇小数则向上取整），下表描述了该「比例」的变化方式，比例的区间选择均为随机。

| 阶段 | 持续时间确定方式 |
|------|------------------|
| 第一次下跌 | 阶段开始时为 **40%-90%**，<br>其后每个半天的比例都会在前一个半天的价格比例基础上下调 3-5 个百分点 |
| 上涨 | 第 1-2 个半天： **90%-140%**<br>第 3-5 个半天：**140%-200%** |
| 第一次下跌 | 和「第一次下跌」相同 |

在该模型下，我们可以获得理论上的最低卖出价，即第一次下跌以 40% 开始，并且持续 7 个半天，每次下调 5 个百分点，到第 7 个半天比例已跌至 10%——这意味着如果以 90 铃钱买入，只能卖出 9 铃钱。


## 参考资料
* [TurnipPrices.cpp](https://gist.github.com/Treeki/85be14d297c80c8b3c0a76375743325b)
* [Breaking Down The Stalk Market](https://docs.google.com/document/d/1bSVNpOnH_dKxkAGr718-iqh8s8Z0qQ54L-0mD-lbrXo/edit?usp=sharing)